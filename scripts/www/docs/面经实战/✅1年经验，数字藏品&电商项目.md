# 面试者背景


:::warning
** 专升本，24年毕业，数字藏品项目，文化&IP数字化藏品，售卖&展示，spring clo****<font style="color:black;">ud Alibaba（nacos、dubbo、sentinel、redis、mysql、shardingjdbc、es），高并发</font>**

**<font style="color:black;"></font>**

**<font style="color:#000000;">负责交易和订单模块，平台用户量多少？注册用户100万，交易用户60万，订单量多少？5000万存量。最近半年卖的最火的是哪一款？河南博物馆陶土小狗，预定量7W。</font>**

**<font style="color:#000000;">下单前都需要预定吗？</font>****<font style="color:#000000;">VIP</font>****<font style="color:#000000;">先购买，开启预定，预定后正常售卖。如何做的购买权限控制？布隆过滤器？刚开通</font>****<font style="color:#000000;">vip</font>****<font style="color:#000000;">还没来得及进入布隆过滤器怎么办？为啥这里要用布隆过滤器？才</font>****<font style="color:#000000;">100</font>****<font style="color:#000000;">万用户，直接查数据库不就行了么？过滤恶意攻击流量，布隆过滤器是基于内存的还是</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">的？</font>**

**<font style="color:#000000;">如果用户的</font>****<font style="color:#000000;">vip</font>****<font style="color:#000000;">到期了，布隆过滤器没办法删除怎么办？预约怎么做的？</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">，</font>****<font style="color:#000000;">set</font>****<font style="color:#000000;">，如何避免一个用户预约多次？</font>**

**<font style="color:#000000;">抗</font>****<font style="color:#000000;">500 qps</font>****<font style="color:#000000;">的方案介绍下？</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">做流量拦截？</font>****<font style="color:#000000;">lua</font>****<font style="color:#000000;">扣减、创建订单、</font>****<font style="color:#000000;">500QPS</font>****<font style="color:#000000;">算高并发么？同一个商品抗</font>****<font style="color:#000000;">3000-4000</font>****<font style="color:#000000;">，阿里云数据库，订单创建为啥要搞</font>****<font style="color:#000000;">2</font>****<font style="color:#000000;">步？要一个订单号</font>**

**<font style="color:#000000;">订单的状态是怎么设计的？</font>****<font style="color:#000000;">INIT</font>****<font style="color:#000000;">，</font>****<font style="color:#000000;">confirm</font>****<font style="color:#000000;">，</font>****<font style="color:#000000;">paid</font>****<font style="color:#000000;">，</font>**

**<font style="color:#000000;">上链，链是自己开发的吗？以太坊</font>**

**<font style="color:#000000;">下单过程什么情况会出现数据不一致，</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">扣成功，应用挂了。旁路验证，</font>**

**<font style="color:#000000;">Redis</font>****<font style="color:#000000;">和数据库库存不一致问题怎么解决？核对告警，人工操作。核对任务怎么做的？</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">流水存储什么数据结构？如何扫描同一个商品的流水？为啥不搞个</font>****<font style="color:#000000;">hash</font>****<font style="color:#000000;">结构，</font>**

**<font style="color:#000000;">如何判断一个商品是否走秒杀链路，网关检查商品过热，如何切流？</font>**

**<font style="color:#000000;">藏品的唯一编号？雪花算法？不需要给用户展示吗？</font>**

**<font style="color:#000000;">藏品的持有编号（顺序）高并发情况下怎么生成的？编号生成好，写库失败了怎么办？藏品</font>****<font style="color:#000000;">id</font>****<font style="color:#000000;">加分布式锁。分布式锁怎么做的？注解</font>****<font style="color:#000000;">+aop</font>****<font style="color:#000000;">切面</font>****<font style="color:#000000;">+redisson</font>****<font style="color:#000000;">，</font>**

**<font style="color:#000000;">分布式锁的自定义注解是你自己写的吗？怎么设计的？</font>****<font style="color:#000000;">key&keyExpression</font>****<font style="color:#000000;">（</font>****<font style="color:#000000;">el</font>****<font style="color:#000000;">表达式），</font>****<font style="color:#000000;">waitTime</font>****<font style="color:#000000;">，</font>****<font style="color:#000000;">releaseTime</font>****<font style="color:#000000;">。</font>****<font style="color:#000000;">AOP</font>****<font style="color:#000000;">拦截，如何确保解锁成功？</font>****<font style="color:#000000;">finally</font>****<font style="color:#000000;">，</font>**

**<font style="color:#000000;">注解的</font>****<font style="color:#000000;">AOP</font>****<font style="color:#000000;">顺序问题如何解决（锁和事务）？加锁了还是有重复数据（事务还没提交，锁就释放了），怎么解决的？</font>****<font style="color:#000000;">order</font>****<font style="color:#000000;">注解。</font>**

**<font style="color:#000000;">介绍下</font>****<font style="color:#000000;">AOP</font>****<font style="color:#000000;">的原理？代理的注册过程，</font>**

**<font style="color:#000000;">分表算法怎么选的？自定义算法，取模，分了多少表？</font>****<font style="color:#000000;">4</font>****<font style="color:#000000;">张？？？</font>**

**<font style="color:#000000;">介绍下</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">的线程模型？单线程执行命令，为什么？原子性，为啥单线程也能很快？</font>**

**<font style="color:#000000;">Redis</font>****<font style="color:#000000;">如何实现多个命令以原子性方式执行？</font>****<font style="color:#000000;">lua</font>****<font style="color:#000000;">脚本为啥能保证原子性？</font>****<font style="color:#000000;">lua</font>****<font style="color:#000000;">脚本</font>****<font style="color:#000000;">执行过程中失败了咋办、</font>****<font style="color:#000000;">lua</font>****<font style="color:#000000;">会回滚吗？不回滚咋保证原子性？</font>****<font style="color:#000000;">redis</font>****<font style="color:#000000;">支持事务吗？不支持。</font>**

**<font style="color:#000000;">代码中写</font>****<font style="color:#000000;">lua</font>****<font style="color:#000000;">有什么缺点吗？</font>****<font style="color:#000000;">不好</font>****<font style="color:#000000;">debug</font>****<font style="color:#000000;">。</font>****<font style="color:#000000;">Redisson</font>****<font style="color:#000000;">框架，</font>****<font style="color:#000000;">jedis</font>****<font style="color:#000000;">用过吗？</font>****<font style="color:#000000;">redisTemplate</font>****<font style="color:#000000;">，各自适合什么场景？</font>**

**<font style="color:#000000;">AI熟吗？RAG的原理是什么？向量库是怎么做检索的？怎么判断相似度？用过哪个向量数据库，FAISS。知道混合检索吗？如何判断一个rag效果好不好？</font>**

:::

# 题目解析


:::color4
**<font style="color:black;">如何做的购买权限控制？布隆过滤器？刚开通vip还没来得及进入布隆过滤器怎么办？为啥这里要用布隆过滤器？才100万用户，直接查数据库不就行了么？过滤恶意攻击流量，布隆过滤器是基于内存的还是redis的？</font>**

**<font style="color:black;">如果用户的vip到期了，布隆过滤器没办法删除怎么办？预约怎么做的？redis，set，如何避免一个用户预约多次？</font>**

:::





[✅什么是布隆过滤器，实现原理是什么？](docs/高性能/✅什么是布隆过滤器，实现原理是什么？.md)



[✅布隆过滤器无法删除的问题如何解决？](docs/高性能/✅布隆过滤器无法删除的问题如何解决？.md)



:::color4
**<font style="color:black;">抗500 qps的方案介绍下？redis做流量拦截？lua扣减、创建订单、500QPS算高并发么？同一个商品抗3000-4000，阿里云数据库，订单创建为啥要搞2步？要一个订单号</font>**

:::



本方案在项目实战课中：

[🧣🧣🧣项目实战课介绍&老用户福利]()



:::color4
**<font style="color:black;">订单的状态是怎么设计的？</font>****<font style="color:black;">INIT</font>****<font style="color:black;">，</font>****<font style="color:black;">confirm</font>****<font style="color:black;">，</font>****<font style="color:black;">paid</font>****<font style="color:black;">，</font>**

**<font style="color:black;">上链，链是自己开发的吗？以太坊</font>**

:::



[✅基于状态机+乐观锁解决订单支付和关单的并发问题](docs/项目难点&亮点/✅基于状态机+乐观锁解决订单支付和关单的并发问题.md)



:::color4
**<font style="color:black;">下单过程什么情况会出现数据不一致，</font>****<font style="color:black;">redis</font>****<font style="color:black;">扣成功，应用挂了。旁路验证，</font>**

**<font style="color:black;">Redis和数据库库存不一致问题怎么解决？核对告警，人工操作。核对任务怎么做的？redis流水存储什么数据结构？如何扫描同一个商品的流水？为啥不搞个hash结构，</font>**

**<font style="color:black;">如何判断一个商品是否走秒杀链路，网关检查商品过热，如何切流？</font>**

:::



本方案在项目实战课中：

[🧣🧣🧣项目实战课介绍&老用户福利]()





:::color4
**<font style="color:black;">藏品的唯一编号？雪花算法？不需要给用户展示吗？</font>**

**<font style="color:black;">藏品的持有编号（顺序）高并发情况下怎么生成的？编号生成好，写库失败了怎么办？藏品id加分布式锁。分布式锁怎么做的？注解+aop切面+redisson，</font>**

:::



藏品编号适合用redis自增id，而不是雪花算法，因为用户要看到顺序的序号，如1 2 3 4。



失败的问题解决方式是加分布式锁，避免并发情况下出现序号乱序的问题。



:::color4
**<font style="color:black;">分布式锁的自定义注解是你自己写的吗？怎么设计的？</font>****<font style="color:black;">key&keyExpression</font>****<font style="color:black;">（</font>****<font style="color:black;">el</font>****<font style="color:black;">表达式），</font>****<font style="color:black;">waitTime</font>****<font style="color:black;">，</font>****<font style="color:black;">releaseTime</font>****<font style="color:black;">。</font>****<font style="color:black;">AOP</font>****<font style="color:black;">拦截，如何确保解锁成功？</font>****<font style="color:black;">finally</font>****<font style="color:black;">，</font>**

**<font style="color:black;">注解的</font>****<font style="color:black;">AOP</font>****<font style="color:black;">顺序问题如何解决（锁和事务）？加锁了还是有重复数据（事务还没提交，锁就释放了），怎么解决的？</font>****<font style="color:black;">order</font>****<font style="color:black;">注解。</font>**

**<font style="color:black;">介绍下AOP的原理？代理的注册过程，</font>**

:::



[✅用了一锁二查三更新，为啥还出现了重复数据？](docs/场景题/✅用了一锁二查三更新，为啥还出现了重复数据？.md)



[✅介绍一下Spring的AOP](docs/Spring/✅介绍一下Spring的AOP.md)



:::color4
**<font style="color:black;">分表算法怎么选的？自定义算法，取模，分了多少表？4张？？？</font>**

:::



[✅分表算法都有哪些？](docs/分库分表/✅分表算法都有哪些？.md)



:::color4
**<font style="color:black;">介绍下redis的线程模型？单线程执行命令，为什么？原子性，为啥单线程也能很快？</font>**

**<font style="color:black;">Redis如何实现多个命令以原子性方式执行？lua脚本为啥能保证原子性？lua脚本</font>****执行过程中失败了咋办、lua会回滚吗？不回滚咋保证原子性？redis支持事务吗？不支持。**

**代码中写lua有什么缺点吗？不好debug。Redisson框架，jedis用过吗？redisTemplate，各自适合什么场景？**

:::



[✅为什么Redis设计成单线程也能这么快？](docs/Redis/✅为什么Redis设计成单线程也能这么快？.md)



[✅为什么Lua脚本可以保证原子性？](docs/Redis/✅为什么Lua脚本可以保证原子性？.md)



:::color4
**AI熟吗？RAG的原理是什么？向量库是怎么做检索的？怎么判断相似度？用过哪个向量数据库，FAISS。知道混合检索吗？如何判断一个rag效果好不好？**

:::







