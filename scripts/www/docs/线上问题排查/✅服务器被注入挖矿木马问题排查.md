我有一台云服务器，用于部署一个我的个人博客的。最近收到告警，说挂了挖矿程序



![](images/3f2b95a41f734c4b94215dbdbf12ce3e.jpeg)



首先看下这个程序是不是已经在跑了，top看下运行的进程，发现有一个kswapd0进行耗CPU比较高，这个进程本身是个linux的后台进程，负责内存交换的，但是熟悉的都知道，他其实是个老演员了。

![](images/2ff77f3431d34b2fbf3d6230702cb6e3.jpeg)



正常的kswapd0不会一直在，也不会占CPU这么高，所以怀疑接下来用 netstat -antlp 看看网络连接情况，挖矿不可能没有远程传输吧。



![](images/d7baa1307a7b41cc969b0857181f6af4.jpeg)



不查不知道，一查就发现了老朋友。通过netstat发现一个瑞士的IP在和kswapd0通信，同时有两个一个罗马尼亚的ip在和rsync这个数据传输进程在不断通信。

![](images/81788a726f5f491e87394f71c30e7c04.jpeg)



接下来就要深挖了，找到这个kswapd0占用的文件路径到底在哪，进入/proc/<pid>这个目录，我这里的<pid>是67498：



![](images/45720c5619ca45ada5a1a2d1b1cebe0f.jpeg)



最终发现是在git用户在有个文件夹，那这个文件夹就可以直接干掉了。



接下来就是删除文件夹、kill掉进程



检查并清除定时任务，删除被黑的账号，

![](images/97d438cd45ee44ed8070ae1d889191fc.jpg)



![](images/96ffadd850f7406a8c058662ba0feafd.jpg)



清楚这个用户的密钥：

![](images/10c1b238e55042d0b1e4cde914b9780f.jpg)



![](images/905c9b305e8c47d4b7267a61990a7580.jpg)



然后机器就恢复正常了。

![](images/339840ff92b643549414205d43e8fe4b.jpg)

